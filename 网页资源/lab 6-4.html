<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微元法面积实验室</title>

    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
            options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
        };
    </script>
    <script defer src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>
    <style>
    :root {
        --primary: #4f46e5;
        --primary-dark: #3730a3;
        --primary-light: #6366f1;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #1f2937;
        --white: #ffffff;
        --light: #ffffff;
        --border: #e5e7eb;
        --h1-size: 22px;
        --h3-size: 18px;
        --text-size: 16px;
        --formula-size: 20px;
    }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        *::-webkit-scrollbar { width: 0; background: transparent; }
        * { scrollbar-width: none; -ms-overflow-style: none; }

            body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
        font-size: var(--text-size);
        line-height: 1.5;
        background: var(--gray-50);
        color: var(--gray-700);
    }

            .container {
        width: 100%;
        max-width: 1400px;
        height: min(100vh, 700px);
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        background: var(--white);
    }

            .header {
        height: 40px;
        background: var(--primary);
        color: var(--white);
        display: flex;
        align-items: center;
        padding: 0 20px;
    }

            .main { flex: 1; display: flex; overflow: hidden; }

            .sidebar {
        width: 120px;
        background: var(--gray-50);
        border-right: 1px solid var(--border);
        padding: 10px 8px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

            .nav-btn {
        width: 100%;
        padding: 8px;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: var(--text-size);
        color: var(--gray-600);
        text-align: left;
        transition: background 0.2s ease, color 0.2s ease;
    }

            .nav-btn.active { background: var(--primary); color: var(--white); }
            .nav-btn:hover { background: var(--gray-100); }

                        .content {
        flex: 1;
        position: relative;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 18px;
        padding: 16px;
        overflow: hidden;
    }
            .column { display: flex; flex-direction: column; gap: 16px; overflow-y: auto; padding-right: 4px; }

            .card { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 12px; display: flex; flex-direction: column; gap: 10px; }

        .card-scroll { overflow-y: auto; }
        .card h3 { font-size: var(--h3-size); color: var(--primary-dark); }
        .card p { line-height: 1.5; }

        .tag-list { display: flex; gap: 8px; flex-wrap: wrap; }
        .tag { font-size: 13px; padding: 4px 10px; border-radius: 999px; background: var(--gray-100); color: var(--gray-500); }

        .info-grid { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 12px; }
        .info-item { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 10px; padding: 10px; font-size: 15px; }
        .info-item strong { color: var(--primary-dark); display: block; margin-bottom: 6px; }

        .controls { display: flex; flex-direction: column; gap: 10px; background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 10px; padding: 10px; }
        .control-row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; }
        .control-row label { font-weight: 600; }
        select { flex: 1; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--gray-300); font-size: 15px; }
        button.action { background: var(--primary); color: var(--white); border: none; border-radius: 8px; padding: 8px 12px; font-size: var(--text-size); cursor: pointer; transition: transform 0.2s ease; }
        button.action.secondary { background: var(--white); color: var(--primary); border: 1px solid var(--primary); }
        button.action:hover { transform: translateY(-2px); }

        .canvas-wrapper { border: 1px solid var(--gray-200); border-radius: 12px; background: var(--gray-50); padding: 10px; display: flex; flex-direction: column; gap: 8px; }
        canvas { width: 100%; height: 280px; border-radius: 10px; background: var(--white); }

        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)); gap: 10px; }
        .input-box { background: var(--white); border: 1px dashed var(--gray-300); border-radius: 10px; padding: 10px; display: flex; flex-direction: column; gap: 6px; }
        .input-box label { font-weight: 600; font-size: 14px; color: var(--primary-dark); }
        .input-box input { border: 1px solid var(--gray-300); border-radius: 8px; padding: 6px 8px; font-size: 15px; }
        .input-box .hint { font-size: 14px; color: var(--gray-500); }
        .hint.success { color: var(--success); }
        .hint.error { color: var(--danger); }

        .status-box { background: #eef2ff; border-radius: 10px; padding: 10px; font-size: 14px; color: var(--primary-dark); }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>微元法面积实验室</h1>
            <div>用“条形微元”构建定积分模型</div>
        </header>
        <div class="main">
            <nav class="sidebar">
                <button class="nav-btn active">直角坐标面积</button>
                <button class="nav-btn">极坐标面积</button>
                <button class="nav-btn">参数方程面积</button>
            </nav>
            <section class="content">
                <div class="column">
                    <div class="card card-scroll">
                        <h3>微元思路</h3>
                        <p>把复杂图形拆成“无数个薄片”，每个薄片面积易于计算，所有薄片面积累加后就得到总体面积。</p>
                        <div class="tag-list">
                            <span class="tag">薄片面积</span>
                            <span class="tag">积分三要素</span>
                            <span class="tag">扫描动画</span>
                            <span class="tag">公式匹配</span>
                        </div>
                        <div class="status-box" id="summaryBox">当前图形：直角坐标区域，被积函数 $f(x)-g(x)$。</div>
                    </div>

                    <div class="card">
                        <h3>三要素提示</h3>
                        <div class="info-grid">
                            <div class="info-item"><strong>变量</strong> 选择条形方向（横条→$dx$，竖条→$dy$，极坐标→$d\theta$）。</div>
                            <div class="info-item"><strong>被积函数</strong> 条形高度：上曲线减下曲线（或半径平方/2）。</div>
                            <div class="info-item"><strong>积分区间</strong> 条形运动范围：左右端点、上下端点或角度范围。</div>
                            <div class="info-item"><strong>定积分表达式</strong> 三要素组合成 $\int_a^b f(变量) d(变量)$。</div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <h3>面积扫描演示</h3>
                        <div class="controls">
                            <div class="control-row">
                                <label>选择图形</label>
                                <select id="shapeSelector"></select>
                                <button class="action secondary" id="toggleAnimation">启动扫描</button>
                            </div>
                        </div>
                        <div class="canvas-wrapper">
                            <canvas id="areaCanvas"></canvas>
                            <div class="status-box" id="areaStatus">薄片正在扫描区域，阴影部分为累计面积。</div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>积分表达式校验</h3>
                        <div class="input-grid">
                            <div class="input-box">
                                <label>积分变量</label>
                                <input type="text" id="varInput" placeholder="例如 x 或 θ" data-key="variable">
                                <span class="hint">选择条形方向的变量。</span>
                            </div>
                            <div class="input-box">
                                <label>被积函数</label>
                                <input type="text" id="integrandInput" placeholder="例如 cos(x)-sin(x)" data-key="integrand">
                                <span class="hint">填上条形高度表达式。</span>
                            </div>
                            <div class="input-box">
                                <label>积分区间</label>
                                <input type="text" id="boundsInput" placeholder="例如 0,pi/4" data-key="bounds">
                                <span class="hint">输入起止值，用逗号分隔。</span>
                            </div>
                        </div>
                        <div class="controls">
                            <div class="control-row">
                                <button class="action" id="checkButton">检查</button>
                                <button class="action secondary" id="showAnswer">显示答案</button>
                            </div>
                        </div>
                        <div class="status-box" id="checkStatus">填写“三要素”后点击检查，系统会给出反馈。</div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        function renderMath() {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise();
            }
        }

        const shapes = [
            {
                category: '直角坐标面积',
                label: '区域：$y_1 = x+1$, $y_2 = 0.5x^2+0.2$, $[0,1]$',
                variable: 'x',
                integrand: '(x+1) - (0.5*x*x+0.2)',
                bounds: [0, 1],
                area: x => ({ upper: x + 1, lower: 0.5 * x * x + 0.2 }),
                exact: (x => x*x/2 + x - (x*x*x/6 + 0.2*x))(1) - (x => x*x/2 + x - (x*x*x/6 + 0.2*x))(0)
            },
            {
                category: '直角坐标面积',
                label: '区域：$y_1 = \cos x$, $y_2 = \sin x$, $[0,\pi/4]$',
                variable: 'x',
                integrand: 'cos(x) - sin(x)',
                bounds: [0, Math.PI / 4],
                area: x => ({ upper: Math.cos(x), lower: Math.sin(x) }),
                exact: Math.cos(0) - Math.cos(Math.PI/4) - (Math.cos(Math.PI/4) - Math.cos(0)) + Math.sin(Math.PI/4) - Math.sin(0)
            },
            {
                category: '极坐标面积',
                label: '极坐标：$r = 1 + \cos \theta$, $[0,\pi]$',
                variable: 'θ',
                integrand: '0.5*(1+cos(theta))^2',
                bounds: [0, Math.PI],
                polar: true,
                areaPolar: theta => 1 + Math.cos(theta),
                exact: 0.5 * (theta => theta + Math.sin(theta))(Math.PI) - 0.5 * (theta => theta + Math.sin(theta))(0)
            }
        ];

        const navButtons = document.querySelectorAll('.nav-btn');
        const shapeSelector = document.getElementById('shapeSelector');
        const areaCanvas = document.getElementById('areaCanvas');
        const areaStatus = document.getElementById('areaStatus');
        const summaryBox = document.getElementById('summaryBox');
        const varInput = document.getElementById('varInput');
        const integrandInput = document.getElementById('integrandInput');
        const boundsInput = document.getElementById('boundsInput');
        const checkButton = document.getElementById('checkButton');
        const showAnswer = document.getElementById('showAnswer');
        const checkStatus = document.getElementById('checkStatus');
        const toggleAnimation = document.getElementById('toggleAnimation');

        let currentCategory = '直角坐标面积';
        let currentIndex = 0;
        let animationActive = false;
        let animationFrame = null;
        let animationT = 0;

        function getCurrentShapes() {
            return shapes.filter(s => s.category === currentCategory);
        }

        function populateShapes() {
            const list = getCurrentShapes();
            shapeSelector.innerHTML = '';
            list.forEach((item, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.innerHTML = item.label;
                shapeSelector.appendChild(option);
            });
            currentIndex = 0;
            shapeSelector.value = currentIndex;
            updateSummary();
            renderMath();
        }

        function updateSummary() {
            const data = getCurrentShapes()[currentIndex];
            summaryBox.textContent = `当前图形：${data.label}`;
        }

        function setupCanvas(canvas) {
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            ctx.scale(dpr, dpr);
            return { ctx, width: rect.width, height: rect.height };
        }

        function drawShape(t) {
            const data = getCurrentShapes()[currentIndex];
            const { ctx, width, height } = setupCanvas(areaCanvas);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);

            const padding = 40;
            ctx.save();
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 6; i++) {
                const x = padding + i * (width - 2 * padding) / 6;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();
            }
            ctx.strokeStyle = '#1f2937';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            ctx.restore();

            if (!data.polar) {
                const [a, b] = data.bounds;
                const steps = 200;
                const values = [];
                let maxY = -Infinity;
                let minY = Infinity;
                for (let i = 0; i <= steps; i++) {
                    const x = a + (i / steps) * (b - a);
                    const { upper, lower } = data.area(x);
                    values.push({ x, upper, lower });
                    maxY = Math.max(maxY, upper, lower);
                    minY = Math.min(minY, upper, lower, 0);
                }
                const toCanvas = (x, y) => {
                    const cx = padding + (x - a) / (b - a) * (width - 2 * padding);
                    const cy = height - padding - (y - minY) / (maxY - minY + 1e-6) * (height - 2 * padding);
                    return { x: cx, y: cy };
                };

                ctx.save();
                ctx.fillStyle = 'rgba(79,70,229,0.2)';
                ctx.beginPath();
                values.forEach(({ x, upper }, index) => {
                    if (x <= a + t * (b - a)) {
                        const pos = toCanvas(x, upper);
                        if (index === 0) ctx.moveTo(pos.x, pos.y);
                        else ctx.lineTo(pos.x, pos.y);
                    }
                });
                for (let i = values.length - 1; i >= 0; i--) {
                    const { x, lower } = values[i];
                    if (x <= a + t * (b - a)) {
                        const pos = toCanvas(x, lower);
                        ctx.lineTo(pos.x, pos.y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();

                ctx.save();
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 2;
                ctx.beginPath();
                values.forEach(({ x, upper }, index) => {
                    const pos = toCanvas(x, upper);
                    if (index === 0) ctx.moveTo(pos.x, pos.y);
                    else ctx.lineTo(pos.x, pos.y);
                });
                ctx.stroke();
                ctx.strokeStyle = '#ef4444';
                ctx.beginPath();
                values.forEach(({ x, lower }, index) => {
                    const pos = toCanvas(x, lower);
                    if (index === 0) ctx.moveTo(pos.x, pos.y);
                    else ctx.lineTo(pos.x, pos.y);
                });
                ctx.stroke();

                const currentX = a + t * (b - a);
                const { upper, lower } = data.area(currentX);
                const base = toCanvas(currentX, lower);
                const top = toCanvas(currentX, upper);
                ctx.strokeStyle = '#f59e0b';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(base.x, base.y);
                ctx.lineTo(top.x, top.y);
                ctx.stroke();
                ctx.restore();

                areaStatus.textContent = `条形位于 x = ${currentX.toFixed(3)}，高度 ≈ ${(upper - lower).toFixed(4)}，当前累计面积约 ${approxArea(data, currentX).toFixed(4)}。`;
            } else {
                const [thetaStart, thetaEnd] = data.bounds;
                const maxR = 2;
                const center = { x: width / 2, y: height / 2 };
                ctx.save();
                ctx.fillStyle = '#f1f5f9';
                ctx.fillRect(0, 0, width, height);
                ctx.strokeStyle = '#1f2937';
                ctx.beginPath();
                ctx.moveTo(0, center.y);
                ctx.lineTo(width, center.y);
                ctx.moveTo(center.x, 0);
                ctx.lineTo(center.x, height);
                ctx.stroke();

                ctx.fillStyle = 'rgba(79,70,229,0.2)';
                ctx.beginPath();
                ctx.moveTo(center.x, center.y);
                for (let theta = thetaStart; theta <= thetaStart + t * (thetaEnd - thetaStart); theta += 0.01) {
                    const r = data.areaPolar(theta);
                    const x = center.x + r / maxR * (width / 2 - 50) * Math.cos(theta);
                    const y = center.y - r / maxR * (height / 2 - 50) * Math.sin(theta);
                    ctx.lineTo(x, y);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();

                areaStatus.textContent = `角度 θ ≈ ${(thetaStart + t * (thetaEnd - thetaStart)).toFixed(3)}，微元面积 $\frac{1}{2}r^2 dθ$。`;
            }
            renderMath();
        }

        function approxArea(data, currentX) {
            if (data.polar) {
                return definiteIntegral(theta => 0.5 * Math.pow(data.areaPolar(theta), 2), data.bounds[0], currentX, 400);
            }
            const [a, b] = data.bounds;
            return definiteIntegral(x => data.area(x).upper - data.area(x).lower, a, currentX, 400);
        }

        function definiteIntegral(fn, a, b, n) {
            const dx = (b - a) / n;
            let sum = 0;
            for (let i = 0; i < n; i++) {
                const x1 = a + i * dx;
                const x2 = x1 + dx;
                sum += 0.5 * (fn(x1) + fn(x2)) * dx;
            }
            return sum;
        }

        function attachEvents() {
            navButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    navButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.textContent.trim();
                    populateShapes();
                    drawShape(animationT);
                });
            });

            shapeSelector.addEventListener('change', () => {
                currentIndex = parseInt(shapeSelector.value, 10);
                updateSummary();
                animationT = 0;
                drawShape(animationT);
            });

            toggleAnimation.addEventListener('click', () => {
                animationActive = !animationActive;
                toggleAnimation.textContent = animationActive ? '暂停扫描' : '启动扫描';
                if (animationActive) animate();
                else cancelAnimationFrame(animationFrame);
            });

            checkButton.addEventListener('click', () => {
                const data = getCurrentShapes()[currentIndex];
                const varValue = varInput.value.trim();
                const integrandValue = integrandInput.value.trim();
                const boundsValue = boundsInput.value.trim();
                const expectedBounds = `${formatBound(data.bounds[0])},${formatBound(data.bounds[1])}`;
                let correct = true;
                if (normalize(varValue) !== normalize(data.variable)) {
                    correct = false;
                }
                if (normalize(integrandValue) !== normalize(data.integrand.replace(/theta/g, 'θ'))) {
                    correct = false;
                }
                if (normalize(boundsValue) !== normalize(expectedBounds)) {
                    correct = false;
                }
                checkStatus.textContent = correct ? '恭喜！三要素全部匹配。' : `仍有不匹配，参考答案：变量 ${data.variable}，被积函数 ${data.integrand}，区间 ${expectedBounds}`;
            });

            showAnswer.addEventListener('click', () => {
                const data = getCurrentShapes()[currentIndex];
                varInput.value = data.variable;
                integrandInput.value = data.integrand;
                boundsInput.value = `${formatBound(data.bounds[0])},${formatBound(data.bounds[1])}`;
                checkStatus.textContent = '答案已填入，可再点击检查确认。';
            });
        }

        function formatBound(value) {
            if (Math.abs(value - Math.PI) < 1e-6) return 'pi';
            if (Math.abs(value - Math.PI / 2) < 1e-6) return 'pi/2';
            if (Math.abs(value - Math.PI / 4) < 1e-6) return 'pi/4';
            return value.toFixed(3).replace(/\.000$/, '');
        }

        function normalize(str) {
            return (str || '')
                .replace(/\\pi/g, 'pi')
                .replace(/θ/g, 'theta')
                .replace(/\s/g, '')
                .toLowerCase();
        }

        function animate() {
            if (!animationActive) return;
            animationT += 0.01;
            if (animationT > 1) animationT = 1;
            drawShape(animationT);
            if (animationT < 1) {
                animationFrame = requestAnimationFrame(animate);
            } else {
                animationActive = false;
                toggleAnimation.textContent = '启动扫描';
            }
        }

        populateShapes();
        attachEvents();
        drawShape(animationT);
        renderMath();
    </script>
</body>
</html>










