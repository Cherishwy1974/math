<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隐函数求导实验室</title>

    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                processEnvironments: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady().then(() => {
                        console.log('MathJax 初始化完成');
                    }).catch((error) => {
                        console.error('MathJax 初始化错误:', error);
                    });
                }
            }
        };
    </script>
    <script defer src="../common-assets/js/mathjax-3.2.2-tex-svg.min.js"></script>

    <style>
    :root {
        --primary: #4f46e5;
        --primary-dark: #3730a3;
        --primary-light: #6366f1;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #1f2937;
        --white: #ffffff;
        --light: #ffffff;
        --border: #e5e7eb;
        --h1-size: 22px;
        --h3-size: 18px;
        --text-size: 16px;
        --formula-size: 20px;
    }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        *::-webkit-scrollbar { width: 0; background: transparent; }
        * { scrollbar-width: none; -ms-overflow-style: none; }

            body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Microsoft YaHei", Arial, sans-serif;
        font-size: var(--text-size);
        line-height: 1.5;
        background: var(--gray-50);
        color: var(--gray-700);
    }

            .container {
        width: 100%;
        max-width: 1400px;
        height: 100vh;
        max-height: 700px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        background: var(--white);
    }

            .header {
        height: 40px;
        background: var(--primary);
        color: var(--white);
        display: flex;
        align-items: center;
        padding: 0 20px;
    }

            .header h1 { font-size: var(--h1-size); margin: 0; }

            .main { flex: 1; display: flex; overflow: hidden; }

            .sidebar {
        width: 120px;
        background: var(--gray-50);
        border-right: 1px solid var(--border);
        padding: 10px 8px;
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

            .nav-btn {
        width: 100%;
        padding: 8px;
        background: transparent;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: var(--text-size);
        color: var(--gray-600);
        text-align: left;
        transition: background 0.2s ease, color 0.2s ease;
    }

            .nav-btn.active { background: var(--primary); color: var(--white); }
            .nav-btn:hover { background: var(--gray-100); }
        .nav-btn:active { transform: translateY(0); }

            .content { flex: 1; position: relative; overflow: hidden; }
            .column { display: flex; flex-direction: column; gap: 16px; overflow-y: auto; padding-right: 4px; }

            .card { background: var(--white); border: 1px solid var(--border); border-radius: 12px; padding: 12px; display: flex; flex-direction: column; gap: 10px; }

        .card h3 { font-size: var(--h3-size); color: var(--primary-dark); }
        .card p { line-height: 1.5; }
        .card-scroll { overflow-y: auto; }

        .tag-list { display: flex; gap: 8px; flex-wrap: wrap; }
        .tag { font-size: 13px; padding: 4px 10px; border-radius: 999px; background: var(--gray-100); color: var(--gray-500); }

        table { width: 100%; border-collapse: collapse; font-size: 15px; }
        th, td { border: 1px solid var(--gray-200); padding: 8px; text-align: center; }
        thead { background: var(--gray-100); }

        .controls { display: flex; flex-direction: column; gap: 10px; background: var(--gray-50); border-radius: 10px; padding: 10px; border: 1px solid var(--gray-200); }
        .control-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap; }
        .control-row label { font-weight: 600; }
        .control-row span { color: var(--primary-dark); font-weight: 600; }
        input[type="range"] { flex: 1; }
        select { flex: 1; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--gray-300); font-size: 15px; }

        .canvas-container { flex: 1; border: 1px solid var(--gray-200); border-radius: 12px; background: var(--gray-50); display: flex; align-items: center; justify-content: center; min-height: 280px; }
        canvas { width: 100%; height: 100%; border-radius: 10px; }

        .legend { display: flex; gap: 12px; flex-wrap: wrap; font-size: 14px; color: var(--gray-600); }
        .legend i { width: 14px; height: 14px; border-radius: 4px; display: inline-block; }

        .btn-group { display: flex; gap: 10px; }
        button.action { flex: 1; background: var(--primary); color: var(--white); border: none; border-radius: 8px; padding: 10px 12px; font-size: var(--text-size); cursor: pointer; transition: transform 0.2s ease; position: relative; z-index: 10; pointer-events: auto; }
        button.action.secondary { background: var(--white); color: var(--primary); border: 1px solid var(--primary); }
        button.action:hover { transform: translateY(-2px); }
        button.action:active { transform: translateY(0); }

        .analysis-box { background: #eef2ff; border: 1px dashed var(--primary-light); padding: 10px; border-radius: 10px; font-size: 15px; line-height: 1.5; }
        .info-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
        .info-item { padding: 10px; border-radius: 10px; background: var(--gray-50); border: 1px solid var(--gray-200); }
        .info-item strong { color: var(--primary-dark); display: block; margin-bottom: 6px; }
        .status-hint { font-size: 14px; color: var(--danger); }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>隐函数求导实验室</h1>
            <div>用 $F(x,y)=0$ 的思维观察切线</div>
        </header>
        <div class="main">
            <nav class="sidebar">
                <button class="nav-btn active">隐函数求导</button>
                <button class="nav-btn">切线几何</button>
                <button class="nav-btn">动态探索</button>
                <button class="nav-btn">常见模型</button>
            </nav>
            <section class="content">
                <!-- 隐函数求导页面 -->
                <div class="page-content" id="page-隐函数求导">
                    <div class="column">
                    <div class="card card-scroll">
                        <h3>学习指引</h3>
                        <p>隐函数求导的核心是对等式 $F(x,y)=0$ 两边同时对 $x$ 求导，再把 $\\dfrac{dy}{dx}$ 解出来。通过图像、表格和动画，我们可以看到不同位置的切线斜率与图形凹凸之间的联系。</p>
                        <div class="tag-list">
                            <span class="tag">隐函数</span>
                            <span class="tag">切线斜率</span>
                            <span class="tag">几何可视化</span>
                            <span class="tag">工程曲线</span>
                        </div>
                        <div class="analysis-box" id="conceptDescription">当前曲线：$x^2 + y^2 = 9$。利用公式 $\\dfrac{dy}{dx} = -\\dfrac{F_x}{F_y}$，可得 $\\dfrac{dy}{dx} = -\\dfrac{x}{y}$。</div>
                    </div>

                    <div class="card card-scroll">
                        <h3>典型隐函数导数表</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>隐函数方程</th>
                                    <th>$\\dfrac{dy}{dx}$</th>
                                    <th>说明</th>
                                </tr>
                            </thead>
                            <tbody id="implicitTable"></tbody>
                        </table>
                    </div>

                    <div class="card">
                        <h3>结论速览</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <strong>通用公式</strong>
                                对 $F(x,y)=0$ 求导得 $\\dfrac{dy}{dx} = -\\dfrac{F_x}{F_y}$，只需计算偏导即可。
                            </div>
                            <div class="info-item">
                                <strong>垂直切线</strong>
                                若 $F_y = 0$，则 $\\dfrac{dy}{dx}$ 不存在，说明切线趋向垂直或存在尖点。
                            </div>
                            <div class="info-item">
                                <strong>多分支处理</strong>
                                同一方程可能有上下或左右分支，需要先确定对应的 $y$ 值。
                            </div>
                            <div class="info-item">
                                <strong>工程应用</strong>
                                轮廓设计、轨迹规划常用隐函数描述形状，再通过导数分析接触与滑动。
                            </div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="card">
                        <h3>切线可视化实验区</h3>
                        <div class="canvas-container">
                            <canvas id="implicitCanvas"></canvas>
                        </div>
                        <div class="legend">
                            <span><i style="background:#2563eb"></i> 隐函数曲线</span>
                            <span><i style="background:#10b981"></i> 切点</span>
                            <span><i style="background:#f59e0b"></i> 切线</span>
                        </div>
                        <div class="controls">
                            <div class="control-row">
                                <label>选择曲线</label>
                                <select id="functionSelector"></select>
                            </div>
                            <div class="control-row">
                                <label>选择分支</label>
                                <select id="branchSelector"></select>
                            </div>
                            <div class="control-row">
                                <label>切点横坐标 x</label>
                                <input type="range" id="xController" min="-3" max="3" step="0.05" value="0">
                                <span id="xDisplay">0.00</span>
                            </div>
                            <div class="btn-group">
                                <button class="action" id="playCurve">启动动画</button>
                                <button class="action secondary" id="resetCurve">重置参数</button>
                            </div>
                            <div class="status-hint" id="statusHint"></div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>数值与语言解读</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <strong>当前方程</strong>
                                <span id="equationText">$x^2 + y^2 = 9$</span>
                            </div>
                            <div class="info-item">
                                <strong>切点坐标</strong>
                                <span id="pointText">$(0.00, 3.00)$</span>
                            </div>
                            <div class="info-item">
                                <strong>导数值</strong>
                                <span id="slopeText">$\\dfrac{dy}{dx} = 0$</span>
                            </div>
                            <div class="info-item">
                                <strong>几何描述</strong>
                                <span id="interpretText">在圆顶点切线水平，对应 $\\dfrac{dy}{dx}=0$。</span>
                            </div>
                        </div>
                        <div class="analysis-box" id="scenarioHint">拖动滑块观察不同位置的切线，可以快速判断曲线在哪些区域陡峭或平缓。</div>
                    </div>
                    </div>
                </div>

                <!-- 切线几何页面 -->
                <div class="page-content" id="page-切线几何" style="display: none;">
                    <div class="column">
                        <div class="card card-scroll">
                            <h3>切线几何原理</h3>
                            <p>隐函数的切线斜率反映曲线的局部方向，通过 $\\dfrac{dy}{dx} = -\\dfrac{F_x}{F_y}$ 可以精确计算。</p>
                            <div class="tag-list">
                                <span class="tag">切线斜率</span>
                                <span class="tag">几何意义</span>
                                <span class="tag">局部线性化</span>
                                <span class="tag">方向导数</span>
                            </div>
                            <div class="analysis-box">
                                <strong>几何解释：</strong><br>
                                • 切线是曲线在某点的最佳线性近似<br>
                                • 斜率反映曲线的陡峭程度和方向<br>
                                • 垂直切线对应 $F_y = 0$ 的情况<br>
                                • 水平切线对应 $F_x = 0$ 的情况
                            </div>
                        </div>

                        <div class="card card-scroll">
                            <h3>切线方程推导</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>步骤</th>
                                        <th>操作</th>
                                        <th>结果</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1</td>
                                        <td>对 $F(x,y)=0$ 求全微分</td>
                                        <td>$F_x dx + F_y dy = 0$</td>
                                    </tr>
                                    <tr>
                                        <td>2</td>
                                        <td>解出 $\\dfrac{dy}{dx}$</td>
                                        <td>$\\dfrac{dy}{dx} = -\\dfrac{F_x}{F_y}$</td>
                                    </tr>
                                    <tr>
                                        <td>3</td>
                                        <td>写出切线方程</td>
                                        <td>$y-y_0 = -\\dfrac{F_x}{F_y}(x-x_0)$</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="card">
                            <h3>特殊情况处理</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>垂直切线</strong>
                                    当 $F_y = 0$ 时，切线方程为 $x = x_0$，曲线在该点垂直。
                                </div>
                                <div class="info-item">
                                    <strong>水平切线</strong>
                                    当 $F_x = 0$ 时，切线方程为 $y = y_0$，曲线在该点水平。
                                </div>
                                <div class="info-item">
                                    <strong>尖点</strong>
                                    当 $F_x = F_y = 0$ 时，需要更高阶导数判断切线方向。
                                </div>
                                <div class="info-item">
                                    <strong>多值函数</strong>
                                    需要确定具体的分支，每个分支有不同的切线。
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="card">
                            <h3>切线几何可视化</h3>
                            <div class="canvas-container">
                                <canvas id="tangentCanvas"></canvas>
                            </div>
                            <div class="legend">
                                <span><i style="background:#2563eb"></i> 隐函数曲线</span>
                                <span><i style="background:#10b981"></i> 切点</span>
                                <span><i style="background:#f59e0b"></i> 切线</span>
                                <span><i style="background:#ef4444"></i> 法线</span>
                            </div>
                        </div>

                        <div class="card">
                            <h3>实际应用案例</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>光学设计</strong>
                                    透镜表面设计需要精确的切线方向来控制光线折射。
                                </div>
                                <div class="info-item">
                                    <strong>机械加工</strong>
                                    刀具路径规划需要考虑工件表面的切线方向。
                                </div>
                                <div class="info-item">
                                    <strong>流体力学</strong>
                                    流线分析需要计算速度场的切线方向。
                                </div>
                                <div class="info-item">
                                    <strong>计算机图形学</strong>
                                    曲面渲染需要计算表面法向量和切线。
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 动态探索页面 -->
                <div class="page-content" id="page-动态探索" style="display: none;">
                    <div class="column">
                        <div class="card card-scroll">
                            <h3>参数化探索方法</h3>
                            <p>通过拖动参数观察不同位置切线的变化，理解隐函数曲线的几何特性。</p>
                            <div class="tag-list">
                                <span class="tag">参数化</span>
                                <span class="tag">动态观察</span>
                                <span class="tag">交互式学习</span>
                                <span class="tag">可视化</span>
                            </div>
                            <div class="analysis-box">
                                <strong>探索策略：</strong><br>
                                • 选择关键点：极值点、拐点、交点<br>
                                • 观察切线变化：斜率、方向、长度<br>
                                • 分析几何特征：凹凸性、对称性<br>
                                • 理解物理意义：速度、加速度
                            </div>
                        </div>

                        <div class="card card-scroll">
                            <h3>典型探索路径</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>圆 $x^2+y^2=r^2$</strong>
                                    从顶点开始，观察切线从水平到垂直的变化过程。
                                </div>
                                <div class="info-item">
                                    <strong>椭圆 $\\dfrac{x^2}{a^2}+\\dfrac{y^2}{b^2}=1$</strong>
                                    比较长短轴方向的切线斜率差异。
                                </div>
                                <div class="info-item">
                                    <strong>双曲线 $xy=c$</strong>
                                    观察渐近线附近的切线行为。
                                </div>
                                <div class="info-item">
                                    <strong>心形线 $(x^2+y^2-1)^3=x^2y^3$</strong>
                                    探索复杂曲线的切线变化。
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>数值分析方法</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>中点法</strong>
                                    使用中点处的导数近似计算切线斜率。
                                </div>
                                <div class="info-item">
                                    <strong>有限差分</strong>
                                    通过相邻点的函数值差计算导数。
                                </div>
                                <div class="info-item">
                                    <strong>迭代求解</strong>
                                    对于复杂隐函数使用牛顿法求解。
                                </div>
                                <div class="info-item">
                                    <strong>符号计算</strong>
                                    使用计算机代数系统精确计算导数。
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="card">
                            <h3>交互式探索工具</h3>
                            <div class="controls">
                                <div class="control-row">
                                    <label>探索模式</label>
                                    <select id="exploreMode">
                                        <option value="manual">手动探索</option>
                                        <option value="auto">自动扫描</option>
                                        <option value="keypoints">关键点</option>
                                    </select>
                                </div>
                                <div class="control-row">
                                    <label>显示选项</label>
                                    <div style="display: flex; gap: 10px;">
                                        <label><input type="checkbox" checked> 切线</label>
                                        <label><input type="checkbox"> 法线</label>
                                        <label><input type="checkbox"> 曲率圆</label>
                                    </div>
                                </div>
                                <div class="btn-group">
                                    <button class="action" id="startExplore">开始探索</button>
                                    <button class="action secondary" id="resetExplore">重置</button>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>探索记录与分析</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>斜率变化</strong>
                                    <span id="slopeChange">观察切线斜率在曲线上的变化规律</span>
                                </div>
                                <div class="info-item">
                                    <strong>几何特征</strong>
                                    <span id="geometricFeature">识别曲线的对称性、周期性等特征</span>
                                </div>
                                <div class="info-item">
                                    <strong>特殊点</strong>
                                    <span id="specialPoints">标记极值点、拐点、交点等关键位置</span>
                                </div>
                                <div class="info-item">
                                    <strong>物理意义</strong>
                                    <span id="physicalMeaning">理解导数在物理问题中的实际含义</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 常见模型页面 -->
                <div class="page-content" id="page-常见模型" style="display: none;">
                    <div class="column">
                        <div class="card card-scroll">
                            <h3>基本几何图形</h3>
                            <p>圆、椭圆、双曲线等常见几何图形都可以用隐函数表示，其导数有明确的几何意义。</p>
                            <div class="tag-list">
                                <span class="tag">圆</span>
                                <span class="tag">椭圆</span>
                                <span class="tag">双曲线</span>
                                <span class="tag">抛物线</span>
                            </div>
                            <div class="analysis-box">
                                <strong>圆锥曲线统一表示：</strong><br>
                                $Ax^2 + Bxy + Cy^2 + Dx + Ey + F = 0$<br>
                                其中 $B^2 - 4AC$ 的符号决定曲线类型
                            </div>
                        </div>

                        <div class="card card-scroll">
                            <h3>圆的隐函数求导</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>标准圆</strong>
                                    $x^2 + y^2 = r^2$，导数：$\\dfrac{dy}{dx} = -\\dfrac{x}{y}$
                                </div>
                                <div class="info-item">
                                    <strong>一般圆</strong>
                                    $(x-h)^2 + (y-k)^2 = r^2$，导数：$\\dfrac{dy}{dx} = -\\dfrac{x-h}{y-k}$
                                </div>
                                <div class="info-item">
                                    <strong>几何意义</strong>
                                    切线斜率等于半径方向斜率的负倒数
                                </div>
                                <div class="info-item">
                                    <strong>特殊点</strong>
                                    在 $(±r, 0)$ 处切线垂直，在 $(0, ±r)$ 处切线水平
                                </div>
                            </div>
                        </div>

                        <div class="card card-scroll">
                            <h3>椭圆的隐函数求导</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>标准椭圆</strong>
                                    $\\dfrac{x^2}{a^2} + \\dfrac{y^2}{b^2} = 1$，导数：$\\dfrac{dy}{dx} = -\\dfrac{b^2x}{a^2y}$
                                </div>
                                <div class="info-item">
                                    <strong>参数关系</strong>
                                    长轴 $a$、短轴 $b$ 影响导数的大小和方向
                                </div>
                                <div class="info-item">
                                    <strong>焦点性质</strong>
                                    椭圆上任意点到两焦点距离之和为常数
                                </div>
                                <div class="info-item">
                                    <strong>应用实例</strong>
                                    行星轨道、卫星轨道、光学透镜设计
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>双曲线的隐函数求导</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>标准双曲线</strong>
                                    $\\dfrac{x^2}{a^2} - \\dfrac{y^2}{b^2} = 1$，导数：$\\dfrac{dy}{dx} = \\dfrac{b^2x}{a^2y}$
                                </div>
                                <div class="info-item">
                                    <strong>渐近线</strong>
                                    $y = ±\\dfrac{b}{a}x$ 是双曲线的渐近线
                                </div>
                                <div class="info-item">
                                    <strong>焦点性质</strong>
                                    双曲线上任意点到两焦点距离之差的绝对值为常数
                                </div>
                                <div class="info-item">
                                    <strong>应用实例</strong>
                                    雷达系统、声学设计、经济学中的边际效用
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="card">
                            <h3>高级几何模型</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>心形线</strong>
                                    $(x^2+y^2-1)^3 = x^2y^3$，具有独特的对称性和尖点
                                </div>
                                <div class="info-item">
                                    <strong>玫瑰线</strong>
                                    $r = a\\sin(n\\theta)$ 在极坐标下的隐函数形式
                                </div>
                                <div class="info-item">
                                    <strong>螺旋线</strong>
                                    $x^2 + y^2 = a^2\\theta^2$ 的隐函数表示
                                </div>
                                <div class="info-item">
                                    <strong>叶形线</strong>
                                    $x^3 + y^3 = 3axy$ 的三次隐函数曲线
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>工程应用模型</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>齿轮设计</strong>
                                    渐开线齿轮的齿廓曲线用隐函数表示
                                </div>
                                <div class="info-item">
                                    <strong>桥梁设计</strong>
                                    悬索桥的主缆形状遵循悬链线方程
                                </div>
                                <div class="info-item">
                                    <strong>光学设计</strong>
                                    非球面透镜表面用高阶隐函数描述
                                </div>
                                <div class="info-item">
                                    <strong>流体力学</strong>
                                    流线方程通常用隐函数形式表示
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <h3>模型比较与选择</h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th>模型类型</th>
                                        <th>优点</th>
                                        <th>缺点</th>
                                        <th>适用场景</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>圆</td>
                                        <td>简单对称</td>
                                        <td>形状单一</td>
                                        <td>基础设计</td>
                                    </tr>
                                    <tr>
                                        <td>椭圆</td>
                                        <td>形状灵活</td>
                                        <td>计算复杂</td>
                                        <td>轨道设计</td>
                                    </tr>
                                    <tr>
                                        <td>双曲线</td>
                                        <td>渐近特性</td>
                                        <td>多分支</td>
                                        <td>极限分析</td>
                                    </tr>
                                    <tr>
                                        <td>复杂曲线</td>
                                        <td>功能强大</td>
                                        <td>难以分析</td>
                                        <td>特殊应用</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        function renderMath() {
            if (window.MathJax && window.MathJax.typesetPromise) {
                MathJax.typesetPromise()
                    .then(() => {
                        console.log('MathJax 公式渲染完成');
                    })
                    .catch(err => {
                        console.error('MathJax 渲染错误:', err);
                        setTimeout(() => {
                            MathJax.typesetPromise().catch(e => console.error('重试失败:', e));
                        }, 200);
                    });
            } else if (window.MathJax && window.MathJax.typeset) {
                try {
                    MathJax.typeset();
                } catch (err) {
                    console.error('MathJax 渲染错误:', err);
                    setTimeout(() => {
                        try { MathJax.typeset(); } catch(e) { console.error('重试失败:', e); }
                    }, 200);
                }
            } else {
                setTimeout(renderMath, 100);
            }
        }

        function forceRenderMath() {
            // 强制重新渲染所有数学公式
            setTimeout(() => {
                if (window.MathJax) {
                    // 清除之前的渲染
                    const mathElements = document.querySelectorAll('.MathJax, [data-math]');
                    mathElements.forEach(el => {
                        if (el.classList.contains('MathJax')) {
                            el.outerHTML = el.innerHTML;
                        }
                    });
                    
                    // 重新渲染
                    if (window.MathJax.typesetPromise) {
                        MathJax.typesetPromise().then(() => {
                            console.log('强制MathJax渲染完成');
                        }).catch(err => {
                            console.error('强制MathJax渲染错误:', err);
                        });
                    }
                }
            }, 50);
        }

        function setupCanvas(canvas) {
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const dpr = window.devicePixelRatio || 1;
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            canvas.style.width = rect.width + 'px';
            canvas.style.height = rect.height + 'px';
            ctx.scale(dpr, dpr);
            return { ctx, width: rect.width, height: rect.height };
        }

        function drawAxes(ctx, width, height) {
            const padding = 40;
            ctx.save();
            ctx.strokeStyle = '#dbeafe';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 8; i++) {
                const x = padding + i * (width - 2 * padding) / 8;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, height - padding);
                ctx.stroke();

                const y = padding + i * (height - 2 * padding) / 8;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }

            ctx.strokeStyle = '#1f2937';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.moveTo(padding, height / 2);
            ctx.lineTo(width - padding, height / 2);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(width / 2, padding);
            ctx.lineTo(width / 2, height - padding);
            ctx.stroke();
            ctx.restore();
        }

        function mathToCanvas(x, y, width, height, xRange, yRange, padding = 40) {
            const plotWidth = width - 2 * padding;
            const plotHeight = height - 2 * padding;
            const cx = padding + (x - xRange[0]) / (xRange[1] - xRange[0]) * plotWidth;
            const cy = height - padding - (y - yRange[0]) / (yRange[1] - yRange[0]) * plotHeight;
            return { x: cx, y: cy };
        }

        const implicitLibrary = {
            circle: {
                label: '圆 $x^2 + y^2 = 9$',
                equation: '$x^2 + y^2 = 9$',
                param: t => ({ x: 3 * Math.cos(2 * Math.PI * t), y: 3 * Math.sin(2 * Math.PI * t) }),
                branches: [
                    { value: 'upper', label: '上半圆 (y \\geq 0)', domain: [-2.9, 2.9], computeY: x => Math.sqrt(Math.max(0, 9 - x * x)) },
                    { value: 'lower', label: '下半圆 (y \\leq 0)', domain: [-2.9, 2.9], computeY: x => -Math.sqrt(Math.max(0, 9 - x * x)) }
                ],
                derivative: (x, y) => -x / y,
                insight: x => `圆上的切线斜率为 $-\\dfrac{x}{y}$。当 $x=${x.toFixed(1)}$ 时，切线介于水平与垂直之间。`
            },
            ellipse: {
                label: '椭圆 $\\dfrac{x^2}{9}+\\dfrac{y^2}{4}=1$',
                equation: '$\\dfrac{x^2}{9}+\\dfrac{y^2}{4}=1$',
                param: t => ({ x: 3 * Math.cos(2 * Math.PI * t), y: 2 * Math.sin(2 * Math.PI * t) }),
                branches: [
                    { value: 'upper', label: '上半支 (y \\geq 0)', domain: [-2.9, 2.9], computeY: x => 2 * Math.sqrt(Math.max(0, 1 - (x * x) / 9)) },
                    { value: 'lower', label: '下半支 (y \\leq 0)', domain: [-2.9, 2.9], computeY: x => -2 * Math.sqrt(Math.max(0, 1 - (x * x) / 9)) }
                ],
                derivative: (x, y) => -(4 * x) / (9 * y),
                insight: x => `椭圆的导数为 $-\\dfrac{4x}{9y}$，比例系数让长轴方向更平缓。当前 $x=${x.toFixed(1)}$，可以观察斜率相对圆的差异。`
            },
            hyperbola: {
                label: '双曲线 $xy = 4$',
                equation: '$xy = 4$',
                param: t => {
                    const s = Math.tanh(4 * (t - 0.5));
                    const x = 1 + 3 * s;
                    return { x, y: 4 / x };
                },
                branches: [
                    { value: 'right', label: '第一象限 (x>0)', domain: [0.9, 4.5], computeY: x => 4 / x },
                    { value: 'left', label: '第三象限 (x<0)', domain: [-4.5, -0.9], computeY: x => 4 / x }
                ],
                derivative: (x, y) => -y / x,
                insight: x => `乘积恒定曲线满足 $\\dfrac{dy}{dx} = -\\dfrac{y}{x}$，一方增大时另一方下降的趋势会更明显。`
            }
        };

        const tableData = [
            { eq: '$x^2 + y^2 = R^2$', derivative: '$\\dfrac{dy}{dx} = -\\dfrac{x}{y}$', note: '圆的切线斜率随角度变化，顶部水平，左右垂直。' },
            { eq: '$\\dfrac{x^2}{a^2}+\\dfrac{y^2}{b^2}=1$', derivative: '$\\dfrac{dy}{dx} = -\\dfrac{b^2 x}{a^2 y}$', note: '椭圆保留比例系数，可以看到长短轴影响导数大小。' },
            { eq: '$xy = c$', derivative: '$\\dfrac{dy}{dx} = -\\dfrac{y}{x}$', note: '乘积不变曲线的导数体现互为倒数的变化速率。' },
            { eq: '$x^2 + xy + y^2 = 7$', derivative: '$\\dfrac{dy}{dx} = -\\dfrac{2x + y}{x + 2y}$', note: '更复杂的隐函数同样遵循 $F_x+F_y\\cdot \\dfrac{dy}{dx}=0$ 的思路。' }
        ];

        const functionSelector = document.getElementById('functionSelector');
        const branchSelector = document.getElementById('branchSelector');
        const xController = document.getElementById('xController');
        const xDisplay = document.getElementById('xDisplay');
        const playCurve = document.getElementById('playCurve');
        const resetCurve = document.getElementById('resetCurve');
        const statusHint = document.getElementById('statusHint');

        const equationText = document.getElementById('equationText');
        const pointText = document.getElementById('pointText');
        const slopeText = document.getElementById('slopeText');
        const interpretText = document.getElementById('interpretText');
        const scenarioHint = document.getElementById('scenarioHint');
        const conceptDescription = document.getElementById('conceptDescription');

        const implicitCanvas = document.getElementById('implicitCanvas');

        let animationId = null;
        let animationActive = false;
        let animationDirection = 1;

        function populateTable() {
            const tbody = document.getElementById('implicitTable');
            tbody.innerHTML = tableData.map(row => `
                <tr>
                    <td>${row.eq}</td>
                    <td>${row.derivative}</td>
                    <td>${row.note}</td>
                </tr>
            `).join('');
            renderMath();
        }

        function populateFunctionSelector() {
            Object.entries(implicitLibrary).forEach(([key, item]) => {
                const option = document.createElement('option');
                option.value = key;
                option.innerHTML = item.label;
                functionSelector.appendChild(option);
            });
        }

        function populateBranchSelector(fnKey) {
            branchSelector.innerHTML = '';
            const fn = implicitLibrary[fnKey];
            fn.branches.forEach(branch => {
                const option = document.createElement('option');
                option.value = branch.value;
                option.innerHTML = branch.label;
                branchSelector.appendChild(option);
            });
        }

        function getCurrentBranch() {
            const fn = implicitLibrary[functionSelector.value];
            return fn.branches.find(branch => branch.value === branchSelector.value) || fn.branches[0];
        }

        function drawCurve(ctx, width, height, fn, xRange, yRange) {
            ctx.save();
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 2;
            ctx.beginPath();
            const steps = 400;
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                const { x, y } = fn.param(t);
                const { x: cx, y: cy } = mathToCanvas(x, y, width, height, xRange, yRange);
                if (i === 0) ctx.moveTo(cx, cy);
                else ctx.lineTo(cx, cy);
            }
            ctx.stroke();
            ctx.restore();
        }

        function drawTangent(ctx, width, height, x0, y0, slope, xRange, yRange) {
            ctx.save();
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            if (!Number.isFinite(slope)) {
                const top = mathToCanvas(x0, yRange[1], width, height, xRange, yRange);
                const bottom = mathToCanvas(x0, yRange[0], width, height, xRange, yRange);
                ctx.beginPath();
                ctx.moveTo(top.x, top.y);
                ctx.lineTo(bottom.x, bottom.y);
            } else {
                const span = 2.5;
                const x1 = x0 - span;
                const x2 = x0 + span;
                const y1 = y0 + slope * (x1 - x0);
                const y2 = y0 + slope * (x2 - x0);
                const p1 = mathToCanvas(x1, y1, width, height, xRange, yRange);
                const p2 = mathToCanvas(x2, y2, width, height, xRange, yRange);
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
            }
            ctx.stroke();
            ctx.restore();
        }

        function updateCanvas() {
            const { ctx, width, height } = setupCanvas(implicitCanvas);
            ctx.clearRect(0, 0, width, height);
            const xRange = [-5, 5];
            const yRange = [-4, 4];
            drawAxes(ctx, width, height);

            const fn = implicitLibrary[functionSelector.value];
            const branch = getCurrentBranch();
            drawCurve(ctx, width, height, fn, xRange, yRange);

            const x0 = parseFloat(xController.value);
            const y0 = branch.computeY(x0);

            if (!Number.isFinite(y0)) {
                statusHint.textContent = '该分支在此 x 上没有实数解，请调整滑块。';
                return;
            }

            const point = mathToCanvas(x0, y0, width, height, xRange, yRange);
            ctx.fillStyle = '#10b981';
            ctx.beginPath();
            ctx.arc(point.x, point.y, 6, 0, Math.PI * 2);
            ctx.fill();

            const slope = fn.derivative(x0, y0);
            drawTangent(ctx, width, height, x0, y0, slope, xRange, yRange);
            statusHint.textContent = '';
            updateInfoPanel(x0, y0, slope, fn);
            renderMath();
        }

        function updateInfoPanel(x, y, slope, fn) {
            equationText.innerHTML = fn.equation;
            pointText.innerHTML = `$(${x.toFixed(2)}, ${y.toFixed(2)})$`;

            if (!Number.isFinite(slope)) {
                slopeText.innerHTML = '$\\dfrac{dy}{dx} = \\infty$';
                interpretText.innerHTML = '此处切线近似垂直，意味着 $F_y = 0$，函数对 $y$ 的变化极其敏感。';
            } else {
                slopeText.innerHTML = `$\\dfrac{dy}{dx} = ${slope.toFixed(3)}$`;
                interpretText.innerHTML = fn.insight(x);
            }

            conceptDescription.innerHTML = `当前曲线：${fn.equation}，代入切点即可得到 $\\dfrac{dy}{dx} = ${Number.isFinite(slope) ? slope.toFixed(3) : '\\infty'}$。`;
            scenarioHint.innerHTML = '配合动画可以比较不同区段的斜率，理解曲线凹凸和趋势变化。';
        }

        function adjustControlsRange() {
            const branch = getCurrentBranch();
            xController.min = branch.domain[0];
            xController.max = branch.domain[1];
            const mid = (branch.domain[0] + branch.domain[1]) / 2;
            xController.value = mid.toFixed(2);
            xDisplay.textContent = mid.toFixed(2);
        }

        function resetAnimation() {
            animationActive = false;
            playCurve.textContent = '启动动画';
            if (animationId) cancelAnimationFrame(animationId);
        }

        function stepAnimation() {
            if (!animationActive) return;
            const branch = getCurrentBranch();
            const min = branch.domain[0];
            const max = branch.domain[1];
            let current = parseFloat(xController.value);
            const step = (max - min) / 320;
            current += step * animationDirection;
            if (current > max || current < min) {
                animationDirection *= -1;
                current = Math.max(min, Math.min(max, current));
            }
            xController.value = current.toFixed(3);
            xDisplay.textContent = parseFloat(xController.value).toFixed(2);
            updateCanvas();
            animationId = requestAnimationFrame(stepAnimation);
        }

        function resetView() {
            resetAnimation();
            functionSelector.value = 'circle';
            populateBranchSelector('circle');
            branchSelector.value = 'upper';
            adjustControlsRange();
            updateCanvas();
        }

        function switchPage(pageName, clickedButton) {
            console.log('切换到页面:', pageName);
            
            // 隐藏所有页面内容
            document.querySelectorAll('.page-content').forEach(page => {
                page.style.display = 'none';
            });
            
            // 移除所有按钮的active类
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 显示当前页面内容
            const currentPage = document.getElementById(`page-${pageName}`);
            if (currentPage) {
                currentPage.style.display = 'flex';
            }
            
            // 为当前按钮添加active类
            const targetButton = clickedButton || Array.from(document.querySelectorAll('.nav-btn')).find(btn => btn.textContent.trim() === pageName.trim());
            if (targetButton) {
                targetButton.classList.add('active');
            }
            
            // 重新渲染数学公式
            setTimeout(() => {
                renderMath();
                if (pageName === '隐函数求导') {
                    updateCanvas();
                }
            }, 100);
            
            // 确保MathJax渲染
            setTimeout(() => {
                forceRenderMath();
            }, 200);
        }

        function initEvents() {
            // 为导航按钮添加事件监听器
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    switchPage(btn.textContent.trim(), btn);
                });
            });
            
            functionSelector.addEventListener('change', () => {
                const key = functionSelector.value;
                populateBranchSelector(key);
                branchSelector.value = implicitLibrary[key].branches[0].value;
                adjustControlsRange();
                resetAnimation();
                updateCanvas();
            });

            branchSelector.addEventListener('change', () => {
                adjustControlsRange();
                resetAnimation();
                updateCanvas();
            });

            xController.addEventListener('input', () => {
                xDisplay.textContent = parseFloat(xController.value).toFixed(2);
                updateCanvas();
            });

            playCurve.addEventListener('click', () => {
                animationActive = !animationActive;
                playCurve.textContent = animationActive ? '暂停动画' : '启动动画';
                if (animationActive) stepAnimation();
                else resetAnimation();
            });

            resetCurve.addEventListener('click', resetView);

            // 切线几何页面的交互功能
            const exploreMode = document.getElementById('exploreMode');
            const startExplore = document.getElementById('startExplore');
            const resetExplore = document.getElementById('resetExplore');
            
            if (exploreMode) {
                exploreMode.addEventListener('change', (e) => {
                    console.log('探索模式改变:', e.target.value);
                    updateTangentCanvas();
                });
            }
            
            if (startExplore) {
                startExplore.addEventListener('click', () => {
                    console.log('开始探索');
                    animateTangentExploration();
                });
            }
            
            if (resetExplore) {
                resetExplore.addEventListener('click', () => {
                    console.log('重置探索');
                    resetTangentExploration();
                });
            }
        }

        // 切线几何页面Canvas绘制函数
        function updateTangentCanvas() {
            const canvas = document.getElementById('tangentCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = 400;
            const height = canvas.height = 300;
            
            ctx.clearRect(0, 0, width, height);
            
            // 绘制坐标轴
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(width/2, 0);
            ctx.lineTo(width/2, height);
            ctx.moveTo(0, height/2);
            ctx.lineTo(width, height/2);
            ctx.stroke();
            
            // 绘制隐函数曲线 (圆)
            ctx.strokeStyle = '#2563eb';
            ctx.lineWidth = 2;
            ctx.beginPath();
            const radius = 80;
            const centerX = width/2;
            const centerY = height/2;
            
            for (let angle = 0; angle < 2 * Math.PI; angle += 0.01) {
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                if (angle === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();
            
            // 绘制切点
            const t = 0.5; // 参数
            const pointX = centerX + radius * Math.cos(t);
            const pointY = centerY + radius * Math.sin(t);
            
            ctx.fillStyle = '#10b981';
            ctx.beginPath();
            ctx.arc(pointX, pointY, 4, 0, 2 * Math.PI);
            ctx.fill();
            
            // 绘制切线
            const tangentSlope = -Math.cos(t) / Math.sin(t);
            const tangentLength = 60;
            const dx = tangentLength / Math.sqrt(1 + tangentSlope * tangentSlope);
            const dy = tangentSlope * dx;
            
            ctx.strokeStyle = '#f59e0b';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(pointX - dx, pointY - dy);
            ctx.lineTo(pointX + dx, pointY + dy);
            ctx.stroke();
            
            // 绘制法线
            const normalSlope = -1 / tangentSlope;
            const normalLength = 40;
            const ndx = normalLength / Math.sqrt(1 + normalSlope * normalSlope);
            const ndy = normalSlope * ndx;
            
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(pointX - ndx, pointY - ndy);
            ctx.lineTo(pointX + ndx, pointY + ndy);
            ctx.stroke();
        }

        // 切线探索动画
        let tangentAnimationId = null;
        let tangentAnimationTime = 0;

        function animateTangentExploration() {
            if (tangentAnimationId) {
                cancelAnimationFrame(tangentAnimationId);
            }
            
            function animate() {
                tangentAnimationTime += 0.02;
                updateTangentCanvas();
                
                // 更新切点位置
                const canvas = document.getElementById('tangentCanvas');
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    const width = canvas.width;
                    const height = canvas.height;
                    const radius = 80;
                    const centerX = width/2;
                    const centerY = height/2;
                    
                    const t = tangentAnimationTime;
                    const pointX = centerX + radius * Math.cos(t);
                    const pointY = centerY + radius * Math.sin(t);
                    
                    // 重绘切点和切线
                    ctx.fillStyle = '#10b981';
                    ctx.beginPath();
                    ctx.arc(pointX, pointY, 4, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    const tangentSlope = -Math.cos(t) / Math.sin(t);
                    const tangentLength = 60;
                    const dx = tangentLength / Math.sqrt(1 + tangentSlope * tangentSlope);
                    const dy = tangentSlope * dx;
                    
                    ctx.strokeStyle = '#f59e0b';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(pointX - dx, pointY - dy);
                    ctx.lineTo(pointX + dx, pointY + dy);
                    ctx.stroke();
                }
                
                tangentAnimationId = requestAnimationFrame(animate);
            }
            
            animate();
        }

        function resetTangentExploration() {
            if (tangentAnimationId) {
                cancelAnimationFrame(tangentAnimationId);
                tangentAnimationId = null;
            }
            tangentAnimationTime = 0;
            updateTangentCanvas();
        }

        window.addEventListener('DOMContentLoaded', () => {
            populateTable();
            populateFunctionSelector();
            populateBranchSelector('circle');
            branchSelector.value = 'upper';
            adjustControlsRange();
            initEvents();
            updateCanvas();
            const firstButton = document.querySelector('.nav-btn');
            if (firstButton) {
                switchPage(firstButton.textContent.trim(), firstButton);
            }
            renderMath();
            
            // 初始化切线几何Canvas
            setTimeout(() => {
                updateTangentCanvas();
            }, 100);
        });
    </script>
</body>
</html>
















