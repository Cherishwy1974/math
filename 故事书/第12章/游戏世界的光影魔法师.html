<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏世界的光影魔法师</title>
    <script src="../../common-assets/js/tailwind.min.js"></script>
    <link rel="stylesheet" href="../../common-assets/css/noto-serif-sc.css">
    <style>
        @font-face {
            font-family: 'Iansui-Regular';
            src: url('../../common-assets/fonts/Iansui-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
        }
        
        /* 美化滚动条 - 竖向 */
        *::-webkit-scrollbar {
            width: 12px;
        }
        *::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
        }
        *::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00ff00, #00cc00);
            border-radius: 6px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        *::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #33ff33, #00ff00);
        }
        *::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #00cc00, #009900);
        }
        
        /* 隐藏横向滚动条 */
        *::-webkit-scrollbar:horizontal {
            display: none;
        }
        
        :root {
            /* 游戏科技主题配色 */
            --bg-start: #0a0a0a;
            --bg-scene1: linear-gradient(135deg, #0f0f0f, #1a1a1a, #252525);
            --bg-scene2: linear-gradient(180deg, #141414, #1f1f1f, #2a2a2a);
            --bg-scene3: linear-gradient(45deg, #0d0d0d, #181818, #232323);
            --bg-scene4: radial-gradient(circle, #1a1a1a, #0f0f0f, #050505);
            --bg-scene5: linear-gradient(315deg, #1e1e1e, #292929);
            --bg-scene6: linear-gradient(135deg, #121212, #1d1d1d, #282828);
            --bg-scene7: linear-gradient(180deg, #0a0a0a, #151515);
            --bg-scene8: linear-gradient(45deg, #0f0f0f, #1a1a1a, #252525);
            --bg-scene9: linear-gradient(135deg, #141414, #1f1f1f, #0a0a0a);
            --bg-scene10: radial-gradient(circle, #1e1e1e, #0a0a0a);
        }

        body {
            font-family: 'Iansui-Regular', serif;
            color: #e0e0e0;
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background-color: var(--bg-start);
            transition: background-color 1.5s ease-in-out;
        }

        #scroll-container {
            height: 1400vh;
            position: relative;
        }

        .sticky-element {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* 代码雨动画背景 */
        #matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
            pointer-events: none;
        }

        /* 像素化过渡效果 */
        .pixel-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            display: grid;
            grid-template-columns: repeat(20, 1fr);
            grid-template-rows: repeat(10, 1fr);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .pixel-block {
            background: #00ff00;
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .pixel-transition.active {
            opacity: 1;
        }

        .pixel-transition.active .pixel-block {
            opacity: 0.8;
            transform: scale(1);
        }

        /* 光线追踪效果 */
        .light-ray {
            position: absolute;
            width: 2px;
            height: 100vh;
            background: linear-gradient(to bottom, transparent, #00ff00, transparent);
            opacity: 0;
            animation: ray-scan 3s infinite;
        }

        @keyframes ray-scan {
            0% { opacity: 0; transform: translateX(-100vw); }
            50% { opacity: 0.5; }
            100% { opacity: 0; transform: translateX(100vw); }
        }

        /* 向量可视化 */
        .vector-display {
            position: absolute;
            font-family: 'Iansui-Regular', serif;
            color: #00ff00;
            font-size: 14px;
            opacity: 0;
            transition: opacity 1s ease;
        }

        .vector-display.active {
            opacity: 0.6;
            animation: vector-pulse 2s infinite;
        }

        @keyframes vector-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* 场景样式 */
        .scene {
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            width: 100%;
            height: 100%;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .scene-background {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            z-index: -2;
        }

        /* 场景背景 */
        .bg-scene1 { background: var(--bg-scene1); }
        .bg-scene2 { background: var(--bg-scene2); }
        .bg-scene3 { background: var(--bg-scene3); }
        .bg-scene4 { background: var(--bg-scene4); }
        .bg-scene5 { background: var(--bg-scene5); }
        .bg-scene6 { background: var(--bg-scene6); }
        .bg-scene7 { background: var(--bg-scene7); }
        .bg-scene8 { background: var(--bg-scene8); }
        .bg-scene9 { background: var(--bg-scene9); }
        .bg-scene10 { background: var(--bg-scene10); }

        /* 图片样式 */
        .illustration-wrapper {
            position: absolute;
            z-index: 5;
            transition: all 1.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .illustration {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 1.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 0;
            transform: scale(0.85) translateY(30px);
            filter: brightness(0.8) contrast(1.2);
        }

        .frame-tech {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            border-radius: 0;
            border: 2px solid #00ff00;
            box-shadow: 
                0 0 20px rgba(0, 255, 0, 0.3),
                inset 0 0 20px rgba(0, 255, 0, 0.1);
        }

        .frame-tech::before {
            content: '';
            position: absolute;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 0, 0.03) 2px,
                rgba(0, 255, 0, 0.03) 4px
            );
            pointer-events: none;
        }

        .illustration-appear {
            opacity: 0.95;
            transform: scale(1) translateY(0);
        }

        .illustration-left {
            left: 10vw;
            top: 50%;
            transform: translateY(-50%);
            width: 35vw;
            height: 55vh;
        }

        .illustration-right {
            right: 10vw;
            top: 50%;
            transform: translateY(-50%);
            width: 35vw;
            height: 55vh;
        }

        /* 文字样式 */
        .story-text {
            position: absolute;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            transition: all 1s cubic-bezier(0.23, 1, 0.32, 1);
            text-align: left;
            padding: 2rem;
            max-width: 280px;
            line-height: 2.2;
            font-weight: 500;
            z-index: 8;
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.12em;
            opacity: 0;
            transform: translateY(20px);
            color: #e0e0e0;
        }

        .story-text-appear {
            opacity: 1;
            transform: translateY(0);
        }

        .text-left {
            left: 30vw;
            top: 50%;
            transform: translateY(-50%);
        }

        .text-right {
            right: 30vw;
            top: 50%;
            transform: translateY(-50%);
        }

        /* 逐字浮现动画 */
        .char-float {
            display: inline-block;
            opacity: 0;
            transform: translateY(15px);
            animation: float-up 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 0;
                transform: translateY(15px) scale(0.9);
            }
            50% {
                opacity: 0.5;
                transform: translateY(5px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* 特殊场景：向量点积演示 */
        #scene7 {
            position: relative;
        }

        #vector-animation {
            position: absolute;
            width: 600px;
            height: 400px;
            opacity: 0;
            transition: opacity 1.5s ease;
            z-index: 20;
        }

        .vector-arrow {
            position: absolute;
            width: 200px;
            height: 2px;
            background: #00ff00;
            transform-origin: left center;
            box-shadow: 0 0 10px #00ff00;
        }

        .vector-arrow::after {
            content: '>';
            position: absolute;
            right: -10px;
            top: -8px;
            color: #00ff00;
            font-size: 20px;
        }

        /* 代码显示效果 */
        .code-display {
            font-family: 'Iansui-Regular', serif;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 20px;
            border: 1px solid #00ff00;
            border-radius: 0;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            font-size: 14px;
            line-height: 1.6;
        }

        /* 封面和封底样式 */
        #scene-cover, #scene-end {
            z-index: 10;
        }

        #scene-cover h1, #scene-cover p, #scene-end p {
            position: relative;
            z-index: 11;
            text-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        }

        /* 响应式设计 */
        @media (max-width: 1366px) {
            .story-text {
                font-size: 1.3rem;
                max-width: 260px;
            }
            .illustration-left,
            .illustration-right {
                width: 33vw;
                height: 50vh;
            }
            .text-left {
               left: 30vw;            }
            .text-right {
                right: 30vw;            }
        }
        
        @media (max-width: 768px) {
            .scene { 
                flex-direction: column; 
                justify-content: center; 
                align-items: center;
                padding: 3vh 3vw;
                gap: 1.5rem;
            }
            .illustration-wrapper { 
                position: relative !important; 
                left: auto !important;
                right: auto !important;
                width: 80vw !important;
                height: 40vh !important;
                margin: 0 auto;
            }
            .story-text { 
                position: relative !important; 
                left: auto !important;
                right: auto !important;
                max-width: 85vw; 
                font-size: 1.1rem;
                writing-mode: horizontal-tb;
                text-orientation: initial;
                letter-spacing: normal;
                margin: 0 auto;
                text-align: center;
                padding: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .story-text {
                font-size: 1rem;
                max-width: 90vw;
                padding: 0.8rem;
            }
            .illustration-wrapper {
                width: 90vw !important;
                height: 35vh !important;
            }
        }
    </style>

    <style>
        .return-home-panel {
            position: fixed;
            top: 16px;
            left: 16px;
            display: flex;
            gap: 10px;
            z-index: 9999;
            flex-wrap: wrap;
        }
        .return-home-panel .return-link {
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.8);
            color: #f8fafc;
            font-size: 14px;
            text-decoration: none;
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.25);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .return-home-panel .return-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(15, 23, 42, 0.35);
        }
        .return-home-panel .return-link.return-main {
            background: rgba(79, 70, 229, 0.85);
        }
        @media (max-width: 640px) {
            .return-home-panel {
                top: 12px;
                left: 12px;
                right: 12px;
                justify-content: center;
            }
            .return-home-panel .return-link {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="return-home-panel">
         <a class="return-link return-sub" href="../index.html">← 返回目录</a>
        <a class="return-link return-main" href="../../index.html">⌂ 返回主站</a>
    </div>
    <!-- 像素化过渡效果 -->
    <div class="pixel-transition" id="pixelTransition">
        <!-- 动态生成像素块 -->
    </div>

    <!-- 代码雨背景 -->
    <canvas id="matrixCanvas"></canvas>

    <!-- 光线追踪效果 -->
    <div class="light-ray" style="animation-delay: 0s;"></div>
    <div class="light-ray" style="animation-delay: 1s;"></div>
    <div class="light-ray" style="animation-delay: 2s;"></div>

    <div id="scroll-container">
        <div id="scene-container" class="sticky-element">

            <!-- 场景背景 -->
            <div id="bg-scene1" class="scene-background bg-scene1"></div>
            <div id="bg-scene2" class="scene-background bg-scene2"></div>
            <div id="bg-scene3" class="scene-background bg-scene3"></div>
            <div id="bg-scene4" class="scene-background bg-scene4"></div>
            <div id="bg-scene5" class="scene-background bg-scene5"></div>
            <div id="bg-scene6" class="scene-background bg-scene6"></div>
            <div id="bg-scene7" class="scene-background bg-scene7"></div>
            <div id="bg-scene8" class="scene-background bg-scene8"></div>
            <div id="bg-scene9" class="scene-background bg-scene9"></div>
            <div id="bg-scene10" class="scene-background bg-scene10"></div>

            <!-- 场景0: 封面 -->
            <div id="scene-cover" class="scene flex-col">
                <h1 class="text-5xl md:text-6xl font-bold text-center" style="color: #00ff00;">游戏世界的<br>光影魔法师</h1>
                <p class="text-xl md:text-2xl mt-4 text-center" style="color: #aaffaa;">向量点积的魔法</p>
                <p class="absolute bottom-20 opacity-80 text-lg">向下滚动，开启故事</p>
            </div>

            <!-- 场景1: 1995年的id Software -->
            <div id="scene1" class="scene">
                <div class="illustration-wrapper illustration-left depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (1).png" alt="id Software" class="illustration">
                    </div>
                </div>
                <p class="story-text text-right depth-layer-3">时间回到1995年。整个世界正为id Software刚刚发布的《毁灭战士》而疯狂。但约翰·卡马克已经将目光投向更遥远的地平线。</p>
            </div>

            <!-- 场景2: 3D世界的愿景 -->
            <div id="scene2" class="scene">
                <div class="illustration-wrapper illustration-right depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (2).png" alt="3D世界" class="illustration">
                    </div>
                </div>
                <p class="story-text text-left depth-layer-3">他心中的下一个世界，是完全真实的3D世界。这个世界，就是后来的传奇——《雷神之锤》（Quake）。</p>
            </div>

            <!-- 场景3: 技术挑战 -->
            <div id="scene3" class="scene">
                <div class="illustration-wrapper illustration-left depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (3).png" alt="技术挑战" class="illustration">
                    </div>
                </div>
                <p class="story-text text-right depth-layer-3">在486或初代奔腾处理器上，构建完全由多边形构成的三维世界已是天方夜谭。而卡马克还要让这个世界拥有动态的、逼真的光影。</p>
            </div>

            <!-- 场景4: 光照贴图方案 -->
            <div id="scene4" class="scene">
                <div class="illustration-wrapper illustration-right depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (4).png" alt="光照贴图" class="illustration">
                    </div>
                </div>
                <p class="story-text text-left depth-layer-3">当时的游戏光照都是假的。卡马克知道，要实现动态光影，必须让电脑实时计算每束光线和每个平面的关系。</p>
            </div>

            <!-- 场景5: Lightmap烘焙 -->
            <div id="scene5" class="scene">
                <div class="illustration-wrapper illustration-left depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (5).png" alt="Lightmap" class="illustration">
                    </div>
                </div>
                <p class="story-text text-right depth-layer-3">他想出了天才般的折中方案："光照贴图"（Lightmap）。预先计算好所有静态光源的光照效果，"烘焙"成特殊贴图。</p>
            </div>

            <!-- 场景6: 向量魔法 -->
            <div id="scene6" class="scene">
                <div class="illustration-wrapper illustration-right depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (6).png" alt="向量魔法" class="illustration">
                    </div>
                </div>
                <p class="story-text text-left depth-layer-3">核心问题：电脑怎么"知道"墙面应该有多亮？答案是向量代数的"魔法咒语"——点积（Dot Product）！</p>
            </div>

            <!-- 场景7: 点积公式演示 -->
            <div id="scene7" class="scene flex-col">
                <!-- 向量动画 -->
                <div id="vector-animation">
                    <svg width="600" height="400" style="position: absolute;">
                        <line x1="300" y1="200" x2="450" y2="150" stroke="#00ff00" stroke-width="2" marker-end="url(#arrowhead)"/>
                        <line x1="300" y1="200" x2="400" y2="100" stroke="#00ffff" stroke-width="2" marker-end="url(#arrowhead2)"/>
                        <text x="460" y="150" fill="#00ff00" font-size="16">N (法向量)</text>
                        <text x="410" y="100" fill="#00ffff" font-size="16">L (光照向量)</text>
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#00ff00"/>
                            </marker>
                            <marker id="arrowhead2" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
                                <polygon points="0 0, 10 3, 0 6" fill="#00ffff"/>
                            </marker>
                        </defs>
                    </svg>
                </div>
                
                <!-- 背景图片 -->
                <div class="illustration-wrapper" style="position: absolute; opacity: 0.2; width: 100%; height: 100%;">
                    <img src="12- (7).png" alt="点积公式" style="object-fit: cover; width: 100%; height: 100%;">
                </div>
                
                <!-- 公式显示 -->
                <div class="code-display" style="position: absolute; bottom: 10vh; max-width: 600px;">
                    <code>亮度 = N·L = |N||L|cos(θ)<br>
// 垂直照射: θ=0°, cos(θ)=1, 最亮<br>
// 平行照射: θ=90°, cos(θ)=0, 无光<br>
// 背面照射: θ>90°, cos(θ)<0, 阴影</code>
                </div>
            </div>

            <!-- 场景8: 计算过程 -->
            <div id="scene8" class="scene">
                <div class="illustration-wrapper illustration-left depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (8).png" alt="计算过程" class="illustration">
                    </div>
                </div>
                <p class="story-text text-right depth-layer-3">这个简洁优雅的数学运算，成为卡马克手中最强大的光影魔法棒。对成千上万个平面进行亿万次点积运算，生成丰富的Lightmap。</p>
            </div>

            <!-- 场景9: 革命到来 -->
            <div id="scene9" class="scene">
                <div class="illustration-wrapper illustration-right depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (9).png" alt="Quake发布" class="illustration">
                    </div>
                </div>
                <p class="story-text text-left depth-layer-3">1996年，《雷神之锤》发布。玩家们被彻底震撼了。火把的光会柔和衰减，墙角会投下真实的阴影。</p>
            </div>

            <!-- 场景10: 影响深远 -->
            <div id="scene10" class="scene">
                <div class="illustration-wrapper illustration-left depth-layer-2">
                    <div class="frame-tech">
                        <img src="12- (10).png" alt="影响深远" class="illustration">
                    </div>
                </div>
                <p class="story-text text-right depth-layer-3">卡马克将深刻的数学理论，用极致的工程效率，塞进了机能孱弱的电脑。他的魔法棒是向量代数，咒语是简洁强大的数学公式。</p>
            </div>

            <!-- 结局 -->
            <div id="scene-end" class="scene flex-col">
                <p class="text-5xl md:text-6xl font-bold" style="color: #00ff00;">完</p>
                <p class="text-xl mt-4" style="color: #aaffaa;">数学与代码创造的游戏世界</p>
            </div>
        </div>
    </div>

    <script>
        const scenes = Array.from(document.querySelectorAll('.scene'));
        const sceneBackgrounds = Array.from(document.querySelectorAll('.scene-background'));
        const sceneCount = scenes.length;
        const scrollContainer = document.getElementById('scroll-container');
        const pixelTransition = document.getElementById('pixelTransition');
        const vectorAnimation = document.getElementById('vector-animation');
        
        let lastSceneIndex = -1;
        let isTransitioning = false;
        let animatedTexts = new Set();
        let vectorAnimationStarted = false;

        // 创建像素化过渡块
        for (let i = 0; i < 200; i++) {
            const pixel = document.createElement('div');
            pixel.className = 'pixel-block';
            pixel.style.transitionDelay = `${Math.random() * 0.3}s`;
            pixelTransition.appendChild(pixel);
        }

        // ========= 代码雨动画 =========
        const matrixCanvas = document.getElementById('matrixCanvas');
        const ctx = matrixCanvas.getContext('2d');
        let canvasWidth = matrixCanvas.width = window.innerWidth;
        let canvasHeight = matrixCanvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvasWidth = matrixCanvas.width = window.innerWidth;
            canvasHeight = matrixCanvas.height = window.innerHeight;
        });

        // 代码雨字符
        const matrix = "01";
        const fontSize = 14;
        const columns = canvasWidth / fontSize;
        const drops = [];

        for (let i = 0; i < columns; i++) {
            drops[i] = Math.random() * -100;
        }

        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
            ctx.fillRect(0, 0, canvasWidth, canvasHeight);
            
            ctx.fillStyle = '#00ff00';
            ctx.font = fontSize + 'px monospace';
            
            for (let i = 0; i < drops.length; i++) {
                const text = matrix[Math.floor(Math.random() * matrix.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                if (drops[i] * fontSize > canvasHeight && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }

        setInterval(drawMatrix, 35);

        // 创建向量显示元素
        function createVectorDisplays() {
            const vectors = [
                { x: '10%', y: '20%', text: 'vec3 N = normalize(normal);' },
                { x: '80%', y: '30%', text: 'vec3 L = normalize(lightDir);' },
                { x: '15%', y: '70%', text: 'float intensity = dot(N, L);' },
                { x: '75%', y: '80%', text: 'color *= max(intensity, 0.0);' }
            ];

            vectors.forEach(v => {
                const div = document.createElement('div');
                div.className = 'vector-display';
                div.style.left = v.x;
                div.style.top = v.y;
                div.textContent = v.text;
                document.body.appendChild(div);
            });
        }
        createVectorDisplays();

        // 像素化过渡效果
        function triggerPixelTransition() {
            if (isTransitioning) return;
            isTransitioning = true;
            
            pixelTransition.classList.add('active');
            
            setTimeout(() => {
                pixelTransition.classList.remove('active');
                isTransitioning = false;
            }, 800);
        }

        // 文字浮现动画
        function animateTextFloat(element) {
            if (animatedTexts.has(element)) return;
            animatedTexts.add(element);
            
            const text = element.textContent;
            element.textContent = '';
            
            [...text].forEach((char, index) => {
                const span = document.createElement('span');
                span.textContent = char;
                span.className = 'char-float';
                span.style.animationDelay = `${index * 0.02}s`;
                element.appendChild(span);
            });
        }

        // 主滚动处理
        window.addEventListener('scroll', () => {
            const scrollHeight = scrollContainer.scrollHeight - window.innerHeight;
            const scrollTop = window.scrollY;
            const scrollPercent = Math.min(scrollTop / scrollHeight, 1);
            
            updateScenes(scrollPercent);
        });

        function updateScenes(percent) {
            const currentSceneIndex = Math.floor(percent * (sceneCount - 0.001));
            const sceneProgress = getSceneProgress(percent, currentSceneIndex);
            
            // 触发场景转换效果
            if (currentSceneIndex !== lastSceneIndex && lastSceneIndex !== -1) {
                if (Math.abs(currentSceneIndex - lastSceneIndex) > 2) {
                    triggerPixelTransition();
                }
            }
            lastSceneIndex = currentSceneIndex;

            // 更新向量显示
            const vectorDisplays = document.querySelectorAll('.vector-display');
            if (currentSceneIndex >= 6 && currentSceneIndex <= 8) {
                vectorDisplays.forEach(v => v.classList.add('active'));
            } else {
                vectorDisplays.forEach(v => v.classList.remove('active'));
            }
            
            // 更新场景显示
            scenes.forEach((scene, index) => {
                const isActive = index === currentSceneIndex;
                scene.style.opacity = isActive ? 1 : 0;
                
                if (isActive) {
                    // 图片动画
                    const img = scene.querySelector('.illustration');
                    if (img && sceneProgress > 0.1) {
                        setTimeout(() => {
                            img.classList.add('illustration-appear');
                        }, 100);
                    }
                    
                    // 文字动画
                    const text = scene.querySelector('.story-text');
                    if (text && sceneProgress > 0.3) {
                        text.classList.add('story-text-appear');
                        if (!animatedTexts.has(text)) {
                            animateTextFloat(text);
                        }
                    }
                } else {
                    // 重置非活动场景
                    const img = scene.querySelector('.illustration');
                    if (img) {
                        img.classList.remove('illustration-appear');
                    }
                    const text = scene.querySelector('.story-text');
                    if (text) {
                        text.classList.remove('story-text-appear');
                    }
                }
            });
            
            // 更新场景背景
            sceneBackgrounds.forEach((bg, index) => {
                const sceneNumber = index + 1;
                const progress = getSceneProgress(percent, sceneNumber);
                bg.style.opacity = progress > 0 ? Math.min(progress * 1.5, 1) : 0;
            });
            
            // 场景7的向量动画
            const p7 = getSceneProgress(percent, 7);
            if (p7 > 0.2 && !vectorAnimationStarted) {
                vectorAnimationStarted = true;
                vectorAnimation.style.opacity = 1;
            } else if (p7 === 0) {
                vectorAnimation.style.opacity = 0;
                vectorAnimationStarted = false;
            }
        }

        function getSceneProgress(percent, sceneIndex) {
            const sceneStart = sceneIndex / sceneCount;
            const sceneEnd = (sceneIndex + 1) / sceneCount;
            if (percent < sceneStart || percent > sceneEnd) return 0;
            return (percent - sceneStart) / (sceneEnd - sceneStart);
        }

        // 初始化
        window.scrollTo(0, 0);
        updateScenes(0);
    </script>
</body>
</html>